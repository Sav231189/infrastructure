# ğŸ” Ceph â€” Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ
  - Ğ±Ğ»Ğ¾Ñ‡Ğ½Ñ‹Ğµ (RBD), Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ğµ (CephFS) Ğ¸ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ½Ñ‹Ğµ (RADOS Gateway) Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹
  - Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ°Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Kubernetes Ñ‡ĞµÑ€ĞµĞ· CSI

##  ğŸ“ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ°
  - MON (Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€ Ğ´ĞµĞ¼Ğ¾Ğ½): Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 3 Ğ½Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ quorum. ĞĞ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ÑÑ‚ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¸ "Ğ¸ÑÑ‚Ğ¸Ğ½Ñƒ" Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¸ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ°. Ceph Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ ĞºĞ²Ğ¾Ñ€ÑƒĞ¼: 2 Ğ¸Ğ· 3 Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹, Ğ¸Ğ½Ğ°Ñ‡Ğµ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€ ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑÑ HEALTH_ERR.
  - MGR (Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ´ĞµĞ¼Ğ¾Ğ½): 1â€“2 Ğ´ĞµĞ¼Ğ¾Ğ½Ğ° Ğ´Ğ»Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ¸ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğ°. ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ceph ÑĞ°Ğ¼ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ MGR, Ğ¸ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ñ‹Ğ¹ MGR (Node 2).
  - OSD (Object Storage Daemon): 
    - OSD â€” ÑÑ‚Ğ¾ Ğ´ĞµĞ¼Ğ¾Ğ½ Ceph, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ·Ğ° Ñ„Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ Ğ¸ Ğ¸Ñ… Ñ€ĞµĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ OSD. ĞĞ° ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ„Ğ¸Ğ·Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ (Ğ¸Ğ»Ğ¸ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹) Ğ´Ğ¸ÑĞº Ğ² ÑƒĞ·Ğ»Ğµ Ğ²Ñ‹ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚Ğµ Ğ¿Ğ¾ 1â€“2 ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€Ğ° ceph-osd Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ² Ceph.
    - ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ½Ğ° Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ/Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ Ğ±Ğ»Ğ¾ĞºĞ¾Ğ² (RBD), Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² (RGW (Rados Gateway) S3 Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) Ğ¸Ğ»Ğ¸ Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (CephFS - MDS (Metadata Server)).
    - Ğ ĞµĞ¿Ğ»Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ OSD ÑĞ¾Ğ³Ğ»Ğ°ÑĞ½Ğ¾ CRUSH-ĞºĞ°Ñ€Ñ‚Ğµ (ğŸ§  CRUSH Map - Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºĞ°Ğ·Ğµ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ¸ÑĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ¿Ğ°Ğ»Ğ¸).
    - ĞÑ‚Ğ²ĞµÑ‡Ğ°Ñ‚ÑŒ Ğ½Ğ° pings Ğ¾Ñ‚ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ñ… Ğ´ĞµĞ¼Ğ¾Ğ½Ğ¾Ğ² (MON) Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ñ ĞºĞ²Ğ¾Ñ€ÑƒĞ¼Ğ° Ğ¸ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ.
  - Pool - ceph-Ğ¿ÑƒĞ» â€” ÑÑ‚Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ğ° Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ, ĞºÑƒĞ´Ğ° Ceph Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ. ĞĞ½ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚:
    - âš™ Ğ¢Ğ¸Ğ¿	replicated (ĞºĞ¾Ğ¿Ğ¸Ğ¸) Ğ¸Ğ»Ğ¸ erasure (ĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)
    - ğŸ§± ĞšĞ¾Ğ»-Ğ²Ğ¾ PG (placement groups)	ĞšĞ°Ğº Ñ€Ğ°Ğ·Ğ±Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾ OSD
    - ğŸ” Replication	Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ ĞºĞ¾Ğ¿Ğ¸Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ
  - Ğ¡ĞµÑ‚ÑŒ â€” Ğ»ÑƒÑ‡ÑˆĞµ Ñ‡ĞµÑ€ĞµĞ· WireGuard Ğ¸Ğ»Ğ¸ VLAN:
    - public_network (ĞºĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ¸Ğ¹ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº)
    - cluster_network (Ñ€ĞµĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ OSD)

## ğŸ“¦ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ceph Ğ½Ğ° VPS ĞºĞ»Ğ°ÑÑ‚ĞµÑ€ Ñ‡ĞµÑ€ĞµĞ· Ansible
> [ansible -> ceph -> readme.md](https://github.com/Sav231189/infrastructure/blob/main/ceph/readme.md)

## ğŸ“¦ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ceph Ğ² k8s ĞºĞ»Ğ°ÑÑ‚ĞµÑ€
> ./install.md