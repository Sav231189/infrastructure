# üîê Vault (HashiCorp) ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ–∫—Ä–µ—Ç–æ–≤

## üìå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Vault ‚Äî —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤—Å–µ—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞:
- –ª–æ–≥–∏–Ω—ã –∏ –ø–∞—Ä–æ–ª–∏
- —Ç–æ–∫–µ–Ω—ã –æ—Ç Docker Registry
- SSH-–∫–ª—é—á–∏ –æ—Ç GitHub
- –ø–∞—Ä–æ–ª–∏ –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö
- –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–ª—é—á–∏ –∏ API

---

## ‚öôÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. NGINX —Å SSL/TLS –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å `https://vault.stroy-track.ru` –Ω–∞ `http://localhost:8200`
2. Vault API –∏ Web UI —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –æ–¥–Ω–æ–º –∏ —Ç–æ–º –∂–µ –ø–æ—Ä—Ç—É `http://localhost:8200`
3. RBAC	–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å ACL –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ —Ä–æ–ª–∏

---

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
1. üñ•Ô∏è –í—ã–¥–µ–ª–µ–Ω–Ω—ã–π VPS (–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è) - **2 CPU / 4 GB RAM / 30+ GB Disk**, –û–°: Ubuntu 20.04+
2. üõ°Ô∏è –ù–∞—Å—Ç—Ä–æ–µ–Ω proxy

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏ Docker (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
```bash
sudo apt update && sudo apt install -y docker.io
```
### 2. –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
```bash
sudo mkdir -p /opt/vault/data
sudo chown 100:100 /opt/vault/data
```
### 3. –ó–∞–ø—É—Å—Ç–∏ Vault –≤ docker
```bash
CONFIG=$(cat <<'EOF'
{
  "storage": {
    "file": { "path": "/vault/data" }
  },
  "listener": {
    "tcp": {
      "address": "0.0.0.0:8200",
      "tls_disable": 1
    }
  },
  "ui": true
}
EOF
)

docker run -d --name vault \
  --cap-add=IPC_LOCK \
  --restart unless-stopped \
  -p 8200:8200 \
  -e VAULT_LOCAL_CONFIG="$CONFIG" \
  -v /opt/vault/data:/vault/data \
  hashicorp/vault:1.13 server
```

### 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Vault
> –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ —Ç—Ä–µ–±—É–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (`vault operator init`):
> - –ó–∞–π—Ç–∏ –≤ –ø–æ–¥–Ω—è—Ç—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º Vault –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é, –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—É—á–∞–µ—à—å
> - 5 Unseal Keys - default=5 –∏–ª–∏ —É–∫–∞–∑–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ (*-key-threshold=2 -key-shares=3* - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ 2 –∏–∑ 3), –Ω—É–∂–Ω—ã –¥–ª—è "—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏" Vault –ø—Ä–∏ –∫–∞–∂–¥–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–∏—Å–∞ (reboot vps).
> - 1 Root Token - –æ—Å–Ω–æ–≤–Ω–æ–π root –∫–ª—é—á (–î–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É Vault)
```bash
docker exec -e VAULT_ADDR=http://127.0.0.1:8200 \
  vault vault operator init -key-shares=3 -key-threshold=2
```

### 5. –£–¥–∞–ª–∏—Ç—å Docker —Å Vault
```bash
docker stop vault
docker rm -f vault 2>/dev/null
```

