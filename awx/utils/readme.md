# [AWX](https://github.com/ansible/awx) - Open Source Automation Platform

# üîê Ansible AWX ‚Äî –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä k3s

## üß† –ß—Ç–æ —Ç–∞–∫–æ–µ Ansible AWX? üìå
- **Ansible** ‚Äî agentless-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è (—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏, deploy –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π). –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ SSH, –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö.
- **AWX** ‚Äî Web-UI —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, API, –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ —É–¥–æ–±–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Ansible. –í—Å—Ç—Ä–æ–µ–Ω Ansible Engine.
- AWX Web UI —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ NGINX proxy —Å SSL: https://ansible.<domain> ‚Üí http://localhost:30080
- RBAC: –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å ACL –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ —Ä–æ–ª–∏ –≤ AWX.

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
1. üñ•Ô∏è –í—ã–¥–µ–ª–µ–Ω–Ω—ã–π VPS (–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è) - **2 CPU / 4 GB RAM / 30+ GB Disk**, –û–°: Ubuntu 20.04+, 
2. üõ°Ô∏è –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π HTTPS-–ø—Ä–æ–∫—Å–∏ –Ω–∞ NGINX (–ø–æ–¥ –¥–æ–º–µ–Ω https://ansible.<domain>)

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ansible AWX –≤ –∫–ª–∞—Å—Ç–µ—Ä k3s
> –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏: k3s
> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å AWX Operator
> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å AWX
- üì¶ ./install.sh

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Vault
> ./vault/readme.md
- üì¶ ./install.sh -> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Vault Collection

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ceph
> ./ceph/readme.md
> –ù–µ–æ–±—Ö–æ–¥–∏–º–æ Inventory (—Å –≥—Ä—É–ø–ø–æ–π ceph) –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Ceph
- üì¶ ./install.sh -> üêò –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Ceph (—Å–æ–∑–¥–∞—Ç—å playbook)

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Citus(Postgres)
> ./citus_pg/readme.md
- üì¶ ./install.sh -> üêò –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Citus + PostgreSQL (—Å–æ–∑–¥–∞—Ç—å playbook)

## üß© –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è –≤ Ansible 
1. Inventory ‚Äî —Å–ø–∏—Å–æ–∫ —Ö–æ—Å—Ç–æ–≤, –∏ –º–æ–∂–µ—à—å –¥–µ–ª–∏—Ç—å –µ–≥–æ –Ω–∞ –≥—Ä—É–ø–ø—ã (–µ—Å—Ç—å default –≥—Ä—É–ø–ø—ã: all,ungrouped)
2. Groups - –ü–æ–∑–≤–æ–ª—è—é—Ç –¥–µ–ª–∞—Ç—å hosts –ø–æ –≥—Ä—É–ø–ø–∞–º –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–∞–∑–Ω—ã–µ —Ä–æ–ª–∏/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ.
3. Project ‚Äî –æ—Ç–∫—É–¥–∞ –±—Ä–∞—Ç—å –ø–ª–µ–π–±—É–∫–∏. –≠—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥), –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è .yml —Ñ–∞–π–ª—ã Ansible.
4. Playbook ‚Äî —á—Ç–æ —Å–¥–µ–ª–∞—Ç—å. –≠—Ç–æ .yml —Ñ–∞–π–ª —Å–æ —Å–ø–∏—Å–∫–æ–º –∑–∞–¥–∞—á.
5. Credentials ‚Äî –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è (SSH –∫–ª—é—á, GitHub token, Vault password, –õ–æ–≥–∏–Ω—ã –∫ –æ–±–ª–∞–∫–∞–º). Ansible –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ SSH –∏–ª–∏ –ø–æ API (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫ AWS/Git).
6. Job Template ‚Äî –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å playbook. –®–∞–±–ª–æ–Ω –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å: –≤—Ä—É—á–Ω—É—é (–∏–∑ UI –∏–ª–∏ API), –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é, –ø—Ä–∏ —Å–æ–±—ã—Ç–∏–∏ (–≤ Webhook)
7. Variables ‚Äî –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ. –ú–æ–∂–µ—à—å –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏—Ö: –≤ playbook, –≤ Inventory, –≤ —à–∞–±–ª–æ–Ω –∑–∞–ø—É—Å–∫–∞, –≤ Credentials (Vault-–ø–∞—Ä–æ–ª—å –∏ —Ç.–¥.)

## üìä –ö–∞–∫ –≤—Å—ë —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–µ
- –¢—ã —Å–æ–∑–¥–∞—ë—à—å Inventory (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–±—Ä–∞—Ç—å –≥—Ä—É–ø–ø—É "–≤—Å–µ [prod] —Å–µ—Ä–≤–µ—Ä–∞").
- –°–æ–∑–¥–∞—ë—à—å Project, —É–∫–∞–∑—ã–≤–∞–µ—à—å –ø—É—Ç—å –∫ Git-–ø–ª–µ–π–±—É–∫–∞–º –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–º.
- –°–æ–∑–¥–∞—ë—à—å Credentials ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
- –°–æ–∑–¥–∞—ë—à—å Job Template, —É–∫–∞–∑—ã–≤–∞–µ—à—å, –∫–∞–∫–æ–π playbook, inventory –∏ credentials.
- –ó–∞–ø—É—Å–∫–∞–µ—à—å Job ‚Äî –∏ –æ–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Å–µ [prod] —Å–µ—Ä–≤–µ—Ä–∞).

## üí• –ß—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –¥–µ–ª–∞—Ç—å —Å Ansible
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å/–æ–±–Ω–æ–≤–ª—è—Ç—å –ü–û
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ñ–∞–π—Ä–≤–æ–ª—ã, nginx, –±–∞–∑—ã
- –°–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, ssh-–∫–ª—é—á–∏, sudo
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –†–∞–±–æ—Ç–∞—Ç—å —Å k8s (–µ—Å—Ç—å k8s –º–æ–¥—É–ª–∏)
- –†–∞–±–æ—Ç–∞—Ç—å —Å AWS, GCP, Docker, GitLab, Vault

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º Inventory, Groups, Hosts, Credentials
  - Add Inventory (–æ–±—ã—á–Ω–æ–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–Ω–≤–µ–Ω—Ç–æ—Ä–∏): 
    - {name: stage, organization: Default}
    - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
  - Resources ‚Üí Inventories ‚Üí stage ‚Üí Groups ‚Üí Add:
    - {name: ceph, description: –¢–æ–ª—å–∫–æ –Ω–æ–¥—ã Ceph}
    - {name: app, description: –¢–æ–ª—å–∫–æ –Ω–æ–¥—ã Kubernetes}
  - Resources ‚Üí Inventories ‚Üí stage ‚Üí Hosts ‚Üí Add host (–ø—É–±–ª–∏—á–Ω—ã–µ IP –∏ –∂–µ–ª–∞–µ–º—ã–µ WireGuard IP):
    - {name: app-stage-01, inventory: stage, variables (YAML —Ä–µ–∂–∏–º): ansible_host: 192.168.3.56 /n wg_ip: 10.10.0.1}
    - {name: ceph-stage-01, inventory: stage, variables (YAML —Ä–µ–∂–∏–º): ansible_host: 192.168.3.77 /n wg_ip: 10.10.0.2}
  - Resources ‚Üí Inventories ‚Üí stage ‚Üí Groups:
    - ceph: Hosts ‚Üí Add ‚Üí existing host - –æ—Ç–º–µ—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–¥—ã Ceph
    - app: Hosts ‚Üí Add ‚Üí existing host - –æ—Ç–º–µ—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–¥—ã Kubernetes
  - –°–æ–∑–¥–∞—ë–º Credential c –ª–æ–≥–∏–Ω–æ–º/–ø–∞—Ä–æ–ª–µ–º:
    - Resources ‚Üí Credentials ‚Üí Add ‚Üí Credential Type: Machine.
    - {name: ubuntu-ssh-password (–∏–ª–∏ –ª—é–±–æ–µ —É–¥–æ–±–Ω–æ–µ), username: ubuntu (–∏–ª–∏ –≤–∞—à —é–∑–µ—Ä –Ω–∞ VPS), password: –≤–∞—à SSH-–ø–∞—Ä–æ–ª—å}
  - –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Ö–æ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ Ad-hoc –∫–æ–º–∞–Ω–¥—É —á–µ—Ä–µ–∑ Credentials:
    - Resources ‚Üí Inventories ‚Üí stage ‚Üí Hosts ‚Üí Run Command 
    - {Module: ping, limit: ceph (–≥—Ä—É–ø–ø–∞ —Å –Ω–æ–¥–∞–º–∏ Ceph), credential: ubuntu-ssh-password}
    - Launch
