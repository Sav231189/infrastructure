# === rook/rook-ceph-cluster values (–≥–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é) ===
operatorNamespace: rook-ceph

cephClusterSpec:
  dataDirHostPath: /var/lib/rook

  cephVersion:
    # image: quay.io/ceph/ceph:v18.2.2 # Reef (—Ä–∞–±–æ—á–∏–π —Ç–µ–≥)
    image: quay.io/ceph/ceph:v19.2.3

  dashboard:
    enabled: true
    ssl: false # –û—Ç–∫–ª—é—á–∞–µ–º SSL - Ingress —Ç–µ—Ä–º–∏–Ω–∏—Ä—É–µ—Ç HTTPS

  mon:
    count: 3
    allowMultiplePerNode: false

  mgr:
    count: 1
    allowMultiplePerNode: false
    # –Ø–≤–Ω–æ –≤–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª–∏ MGR (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Object Storage - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å rgw)
    modules:
      - name: rgw # –î–ª—è Object Gateway –≤ Dashboard
        enabled: true

  # ========================================================================
  # PLACEMENT - –≥–¥–µ –∑–∞–ø—É—Å–∫–∞—Ç—å Ceph –¥–µ–º–æ–Ω—ã (MON/MGR/OSD)
  # ========================================================================
  # all - –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º (mon, mgr, osd)
  placement:
    all:
      # Tolerations - —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—É—Å–∫ –Ω–∞ storage-–Ω–æ–¥–∞—Ö —Å taint
      tolerations:
        - key: "workload" # –ö–ª—é—á taint –Ω–∞ storage-–Ω–æ–¥–∞—Ö
          operator: "Equal"
          value: "storage" # –ó–Ω–∞—á–µ–Ω–∏–µ taint
          effect: "NoSchedule" # –≠—Ñ—Ñ–µ–∫—Ç (NoSchedule = –æ–±—ã—á–Ω—ã–µ –ø–æ–¥—ã –Ω–µ –ø–æ–ø–∞–¥—É—Ç)

      # NodeAffinity - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Ç–æ–ª—å–∫–æ –Ω–∞ storage-–Ω–æ–¥–∞—Ö
      # –î–µ–º–æ–Ω—ã Ceph –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–æ–¥–∞—Ö —Å label role=ceph
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
            - matchExpressions:
                - key: role
                  operator: In
                  values: ["ceph"]

  # ========================================================================
  # –†–ï–°–£–†–°–´ –¥–ª—è Ceph –¥–µ–º–æ–Ω–æ–≤ - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ 4GB RAM –Ω–æ–¥—ã
  # ========================================================================
  # –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –†–ï–ê–õ–¨–ù–û–ú –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏ –≤ production
  # Requests –∑–∞–Ω–∏–∂–µ–Ω—ã (—Ä–µ–∞–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≤—ã—à–µ) –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è
  resources:
    # MON (Monitor) - —Ö—Ä–∞–Ω–∏—Ç –∫–∞—Ä—Ç—É –∫–ª–∞—Å—Ç–µ—Ä–∞, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è 3 —à—Ç –¥–ª—è –∫–≤–æ—Ä—É–º–∞ (quorum)
    mon:
      requests: { cpu: "150m", memory: "384Mi" } # —Ä–µ–∞–ª—å–Ω–æ ~460Mi
      limits: { memory: "1Gi" }

    # MGR (Manager) - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, Dashboard, –º–µ—Ç—Ä–∏–∫–∏
    # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è 1-2 —à—Ç (active + standby)
    mgr:
      requests: { cpu: "150m", memory: "512Mi" } # —Ä–µ–∞–ª—å–Ω–æ ~540Mi
      limits: { memory: "1Gi" }

    # OSD (Object Storage Daemon) - —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫–∞—Ö
    # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ 1 –Ω–∞ –∫–∞–∂–¥—ã–π –¥–∏—Å–∫ (—É –≤–∞—Å 3 OSD)
    osd:
      requests: { cpu: "400m", memory: "512Mi" } # —Ä–µ–∞–ª—å–Ω–æ ~350Mi
      limits: { memory: "1.5Gi" }

  # –°–Ω–∏–∂–∞–µ–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ OSD
  annotations:
    osd:
      rook.io/ceph-osd-memory-target: "1073741824" # ~1GiB

  # –Ø–í–ù–û –∑–∞–¥–∞—ë–º –¥–∏—Å–∫–∏/—Ä–∞–∑–¥–µ–ª—ã (–Ω–∏–∫–∞–∫–æ–≥–æ useAll*)
  # –í–ê–ñ–ù–û: –î–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ (—á–µ—Ä–µ–∑ resize) –∏—Å–ø–æ–ª—å–∑—É–µ–º LVM!
  storage:
    useAllNodes: false
    useAllDevices: false
    nodes:
      - name: storage-1 # –ò–º—è –Ω–æ–¥—ã –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
        devices:
          - name: /dev/ceph-vg-1/osd-lv # LVM –ø–æ–≤–µ—Ä—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
      - name: storage-2 # –ò–º—è –Ω–æ–¥—ã –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
        devices:
          - name: /dev/ceph-vg-2/osd-lv # LVM –ø–æ–≤–µ—Ä—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
      - name: storage-3 # –ò–º—è –Ω–æ–¥—ã –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
        devices:
          - name: /dev/ceph-vg-3/osd-lv # LVM –ø–æ–≤–µ—Ä—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
          # - name: /dev/disk/by-id/scsi-0QEMU_QEMU_HARDDISK_drive-scsi1 # –û—Ç–¥–µ–ª—å–Ω—ã–π –¥–∏—Å–∫

  # –ú–æ–∂–Ω–æ –≤—ã–∫–ª—é—á–∏—Ç—å —Å–±–æ—Ä—â–∏–∫ –∫—Ä—ç—à–µ–π –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö –Ω–æ–¥–∞—Ö
  crashCollector:
    disable: true

# --- –ü—É–ª RBD + StorageClass (RWO, –ø–æ–¥ –ë–î –∏ —Ç.–ø.) ---
cephBlockPools:
  - name: replicapool
    spec:
      failureDomain: host
      replicated:
        size: 2 # —Å—Ç–∞—Ä—Ç–æ–≤–æ —ç–∫–æ–Ω–æ–º–∏–º –º–µ—Å—Ç–æ; –ø–æ–∑–∂–µ –ø–µ—Ä–µ–≤–µ–¥—ë—à—å –Ω–∞ 3
    storageClass:
      enabled: true
      name: ceph-rbd
      isDefault: true # —Å–¥–µ–ª–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –∫–ª–∞—Å—Å–æ–º
      reclaimPolicy: Delete
      allowVolumeExpansion: true
      volumeBindingMode: WaitForFirstConsumer
      parameters:
        imageFormat: "2"
        imageFeatures: layering
        csi.storage.k8s.io/fstype: ext4
        csi.storage.k8s.io/provisioner-secret-name: rook-csi-rbd-provisioner
        csi.storage.k8s.io/provisioner-secret-namespace: "{{ .Release.Namespace }}"
        csi.storage.k8s.io/controller-expand-secret-name: rook-csi-rbd-provisioner
        csi.storage.k8s.io/controller-expand-secret-namespace: "{{ .Release.Namespace }}"
        csi.storage.k8s.io/controller-publish-secret-name: rook-csi-rbd-provisioner
        csi.storage.k8s.io/controller-publish-secret-namespace: "{{ .Release.Namespace }}"
        csi.storage.k8s.io/node-stage-secret-name: rook-csi-rbd-node
        csi.storage.k8s.io/node-stage-secret-namespace: "{{ .Release.Namespace }}"

# ========================================================================
# –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–ò–ü–ê–ú–ò –•–†–ê–ù–ò–õ–ò–©
# ========================================================================

# === RBD (Block Storage) - –í–°–ï–ì–î–ê –í–ö–õ–Æ–ß–ï–ù ===
# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤—ã—à–µ –≤ cephBlockPools (replicapool)

# === CephFS (File System) - –í–ö–õ–Æ–ß–ò–¢–¨/–í–´–ö–õ–Æ–ß–ò–¢–¨ –ü–û –ù–ï–û–ë–•–û–î–ò–ú–û–°–¢–ò ===
# –ï—Å–ª–∏ –ù–ï –Ω—É–∂–µ–Ω shared storage (RWX) - –æ—Ç–∫–ª—é—á–∏—Ç–µ:
#   1. –í values-operator.yaml: enableCephfsDriver: false
#   2. –ó–¥–µ—Å—å: storageClass.enabled: false (–∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ –≤–µ—Å—å –±–ª–æ–∫ cephFileSystems)
# –ï—Å–ª–∏ –ù–ï –Ω—É–∂–µ–Ω shared storage (RWX) - –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤:
cephFileSystems: []
# –≠–∫–æ–Ω–æ–º–∏—è: -48 PG, -2 MDS –ø–æ–¥–∞, -80Mi –ø–∞–º—è—Ç–∏
# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω CephFS –∏ –≤ values-cluster.yaml –≤–∫–ª—é—á–∏—Ç—å enableCephfsDriver: true
# cephFileSystems:
#   - name: cephfs
#     spec:
#       metadataPool:
#         replicated: { size: 2 } # –ø–æ–∑–∂–µ –º–æ–∂–Ω–æ –Ω–∞ 3
#       dataPools:
#         - replicated: { size: 2 }
#       metadataServer:
#         activeCount: 1
#         activeStandby: true
#         # Placement –¥–ª—è MDS (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞ ceph-–Ω–æ–¥–∞—Ö!)
#         placement:
#           tolerations:
#             - key: "workload"
#               operator: "Equal"
#               value: "storage"
#               effect: "NoSchedule"
#           nodeAffinity:
#             requiredDuringSchedulingIgnoredDuringExecution:
#               nodeSelectorTerms:
#                 - matchExpressions:
#                     - key: role
#                       operator: In
#                       values: ["ceph"]
#     storageClass:
#       enabled: true # –≤–∫–ª—é—á–∏ true, –∫–æ–≥–¥–∞ RWX –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è
#       name: cephfs
#       allowVolumeExpansion: true
#       reclaimPolicy: Delete
#       volumeBindingMode: WaitForFirstConsumer
#       parameters:
#         mounter: kernel
#         csi.storage.k8s.io/provisioner-secret-name: rook-csi-cephfs-provisioner
#         csi.storage.k8s.io/provisioner-secret-namespace: "{{ .Release.Namespace }}"
#         csi.storage.k8s.io/controller-expand-secret-name: rook-csi-cephfs-provisioner
#         csi.storage.k8s.io/controller-expand-secret-namespace: "{{ .Release.Namespace }}"
#         csi.storage.k8s.io/controller-publish-secret-name: rook-csi-cephfs-provisioner
#         csi.storage.k8s.io/controller-publish-secret-namespace: "{{ .Release.Namespace }}"
#         csi.storage.k8s.io/node-stage-secret-name: rook-csi-cephfs-node
#         csi.storage.k8s.io/node-stage-secret-namespace: "{{ .Release.Namespace }}"

# === Object Storage (S3/Swift API) - –í–ö–õ–Æ–ß–ò–¢–¨/–í–´–ö–õ–Æ–ß–ò–¢–¨ ===
# RGW (RADOS Gateway) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API –¥–ª—è –æ–±—ä–µ–∫—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
#
# ‚ö†Ô∏è –í–ê–ñ–ù–û: –°–æ–∑–¥–∞–µ—Ç 11+ –ø—É–ª–æ–≤ –∏ ~200 PG! –ë–æ–ª—å—à–æ–π overhead!
#
# ‚ÑπÔ∏è CSI –î–†–ê–ô–í–ï–† –ù–ï –ù–£–ñ–ï–ù: RGW —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ HTTP/S3 API (–Ω–µ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ volume)
#
# üí° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –¥–ª—è –º–∞–ª—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤: MinIO + PVC –Ω–∞ Ceph RBD
#    - –ü—Ä–æ—â–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ, –∫—Ä–∞—Å–∏–≤—ã–π UI
#    - –ù–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –ª–∏—à–Ω–∏–π —Å–ª–æ–π (MinIO ‚Üí RBD ‚Üí Ceph)
#
# üéØ –î–ª—è –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö storage –Ω–æ–¥: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Ceph RGW (–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)
#    - RGW –ø–æ–¥—ã –∑–∞–ø—É—Å—Ç—è—Ç—Å—è –Ω–∞ storage –Ω–æ–¥–∞—Ö —Ä—è–¥–æ–º —Å OSD
#    - –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ Ceph, –º–µ–Ω—å—à–µ overhead
#
# –ï—Å–ª–∏ –ù–ï –Ω—É–∂–µ–Ω S3 API - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –±–ª–æ–∫ cephObjectStores
# –≠–∫–æ–Ω–æ–º–∏—è: -200+ PG, -1 RGW –ø–æ–¥, -–º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏
#
# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω Object Storage:
cephObjectStores:
  - name: ceph-objectstore
    spec:
      # Metadata Pool - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–æ–≤ (–∏–º–µ–Ω–∞, –≤–ª–∞–¥–µ–ª—å—Ü—ã)
      metadataPool:
        failureDomain: host
        replicated:
          size: 2 # 3 —Ä–µ–ø–ª–∏–∫–∏ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

      # Data Pool - –¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–æ–≤ (erasure coded –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞)
      dataPool:
        failureDomain: host
        erasureCoded:
          dataChunks: 2 # 2 —á–∞—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
          codingChunks: 1 # 1 —á–∞—Å—Ç—å –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
        parameters:
          bulk: "true" # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤

      # Gateway - HTTP —Å–µ—Ä–≤–µ—Ä (S3 API endpoint)
      gateway:
        instances: 1 # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ RGW –ø–æ–¥–æ–≤
        port: 80
        priorityClassName: system-cluster-critical

        # Placement - –∑–∞–ø—É—Å–∫–∞–µ–º RGW –Ω–∞ ceph –Ω–æ–¥–∞—Ö (—Ä—è–¥–æ–º —Å OSD)
        placement:
          tolerations:
            - key: workload
              operator: Equal
              value: storage
              effect: NoSchedule
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
                - matchExpressions:
                    - key: role
                      operator: In
                      values: ["ceph"]

        resources:
          requests:
            cpu: 500m
            memory: 512Mi
          limits:
            memory: 1Gi

      preservePoolsOnDelete: true # –ù–µ —É–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ CRD

    # StorageClass –¥–ª—è S3 buckets (—á–µ—Ä–µ–∑ Object Bucket Claims)
    storageClass:
      enabled: true
      name: ceph-bucket
      reclaimPolicy: Delete
      volumeBindingMode: Immediate
      parameters:
        region: us-east-1

# === Toolbox - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø) ===
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ–º–∞–Ω–¥: kubectl exec -n rook-ceph deploy/rook-ceph-tools -- ceph status
toolbox:
  enabled: true
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      memory: 1Gi
