# Woodpecker CI (Kubernetes / Helm)

## –ß—Ç–æ —ç—Ç–æ?

–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π CI/CD (—Ñ–æ—Ä–∫ Drone). –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑—ã –ø—Ä–∏ –ø—É—à–µ –≤ GitHub –∏ –ø—É–±–ª–∏–∫—É–µ—Ç –≤ Harbor.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

- **Server** - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ API
- **Agent** - –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–±–æ—Ä–∫–∏ (–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è)
- **SQLite** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

---

## –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª values.yaml

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `woodpecker-values.yaml` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

‚ö†Ô∏è **–ò–∑–º–µ–Ω–∏—Ç–µ —Ç–æ–ª—å–∫–æ URL –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω:**

```yaml
server:
  host: "https://woodpecker.stroy-track.ru" # ‚Üê –ó–ê–ú–ï–ù–ò–¢–¨: –≤–∞—à –¥–æ–º–µ–Ω
  logLevel: "info"
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  persistence:
    enabled: true
    storageClass: "ceph-rbd"
    size: 5Gi

agent:
  replicas: 2
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 2000m
      memory: 2Gi

ingress:
  enabled: true
  className: "nginx"
  hosts:
    - host: woodpecker.stroy-track.ru # ‚Üê (—Ç–æ—Ç –∂–µ –¥–æ–º–µ–Ω)
      paths:
        - path: /
          pathType: Prefix
  tls: []
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"

database:
  type: sqlite
```

### 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –°–æ–∑–¥–∞—Ç—å namespace
kubectl create namespace woodpecker

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Woodpecker
helm install woodpecker \
  oci://ghcr.io/woodpecker-ci/helm/woodpecker \
  --namespace woodpecker \
  --values woodpecker-values.yaml
```

**–û–∂–∏–¥–∞–π—Ç–µ:** `STATUS: deployed`

---

## –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–µ—Ä–µ–∑ Lens

–û—Ç–∫—Ä–æ–π—Ç–µ **Lens** –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

### 1. Helm Release

1. **Helm** (–ª–µ–≤–æ–µ –º–µ–Ω—é) ‚Üí **Releases**
2. Namespace: `woodpecker`
3. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–ª–∏–∑: `woodpecker` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º **Deployed**

### 2. Pods (–ø–æ–¥—ã)

1. **Workloads** ‚Üí **Pods**
2. Namespace: `woodpecker`
3. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å **Running**:
   - `woodpecker-server-xxxxx` (1 —à—Ç)
   - `woodpecker-agent-xxxxx` (2 —à—Ç)

**–ï—Å–ª–∏ –ø–æ–¥—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è:**

- –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ø–æ–¥ ‚Üí **Logs** ‚Üí —Å–º–æ—Ç—Ä–∏—Ç–µ –æ—à–∏–±–∫—É

### 3. Ingress

1. **Network** ‚Üí **Ingresses**
2. Namespace: `woodpecker`
3. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å ingress —Å –≤–∞—à–∏–º –¥–æ–º–µ–Ω–æ–º

---

## –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞ –≤ NPM

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–∫—Å–∏ –≤ Nginx Proxy Manager:

1. **Proxy Hosts** ‚Üí **Add Proxy Host**
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **Domain Names:** `woodpecker.stroy-track.ru`
   - **Scheme:** `http` (–Ω–µ https!)
   - **Forward Hostname/IP:** IP –≤–∞—à–µ–≥–æ Ingress (—É–∑–Ω–∞—Ç—å –≤ Lens: **Network** ‚Üí **Services** ‚Üí `ingress-nginx-controller`)
   - **Forward Port:** `80`
   - **Websockets Support:** ‚úÖ (–≤–∫–ª—é—á–∏—Ç—å)
3. –í–∫–ª–∞–¥–∫–∞ **SSL:**
   - **SSL Certificate:** Request a new Let's Encrypt Certificate
   - **Force SSL:** ‚úÖ
   - **Email:** –≤–∞—à email
4. **Save**

---

## –®–∞–≥ 4: –°–æ–∑–¥–∞—Ç—å GitHub OAuth App

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://github.com/settings/developers
2. **New OAuth App**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **Application name:** `Woodpecker CI`
   - **Homepage URL:** `https://woodpecker.stroy-track.ru`
   - **Authorization callback URL:** `https://woodpecker.stroy-track.ru/authorize`
4. **Register application**
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Client ID** –∏ **Client Secret** (–ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –≤ UI Woodpecker CI –ø–æ–∑–∂–µ)

---

## –®–∞–≥ 5: –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Woodpecker UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://woodpecker.stroy-track.ru`
2. –£–≤–∏–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub OAuth –≤ UI

1. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **GitHub**
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **Client ID:** –≤—Å—Ç–∞–≤—å—Ç–µ Client ID –∏–∑ —à–∞–≥–∞ 1
   - **Client Secret:** –≤—Å—Ç–∞–≤—å—Ç–µ Client Secret –∏–∑ —à–∞–≥–∞ 1
3. –ù–∞–∂–º–∏—Ç–µ **Continue** –∏–ª–∏ **Save**
4. –í–∞—Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ GitHub –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
5. –ù–∞–∂–º–∏—Ç–µ **Authorize**
6. –í—ã –≤ Woodpecker! üéâ

> **–í–∞–∂–Ω–æ:** –ü–µ—Ä–≤—ã–π –≤–æ—à–µ–¥—à–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

> **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ GitHub –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Admin Settings** (–∏–∫–æ–Ω–∫–∞ —à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∏) ‚Üí **Configure** ‚Üí –¥–æ–±–∞–≤—å—Ç–µ GitHub –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–º.

---

## –†–∞–±–æ—Ç–∞ –≤ UI: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

### 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–∑ GitHub

1. **Repositories** (–ª–µ–≤–æ–µ –º–µ–Ω—é)
2. –ö–Ω–æ–ø–∫–∞ **Reload repositories** (—Å–ø—Ä–∞–≤–∞ —Å–≤–µ—Ä—Ö—É, –∏–∫–æ–Ω–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 3-5 —Å–µ–∫—É–Ω–¥ (–∏–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)

### 2. –í–∫–ª—é—á–∏—Ç—å CI –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

1. –ù–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ —Å–ø–∏—Å–∫–µ
2. –ù–∞–∂–º–∏—Ç–µ **Enable**
3. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω ‚úÖ

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Üí **Settings** (–≤–∫–ª–∞–¥–∫–∞ —Å–≤–µ—Ä—Ö—É):

**General:**

- **Trusted:** ‚úÖ (—Ä–∞–∑—Ä–µ—à–∏—Ç—å Docker –∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ volumes)
- **Protected:** ‚úÖ (—Ç–æ–ª—å–∫–æ admin –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- **Timeout:** `3600` (1 —á–∞—Å –º–∞–∫—Å. –Ω–∞ —Å–±–æ—Ä–∫—É)

**–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**

---

## –†–∞–±–æ—Ç–∞ –≤ UI: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤

–°–µ–∫—Ä–µ—Ç—ã –¥–ª—è Harbor/Docker Registry:

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

1. **Repositories** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. **Settings** ‚Üí **Secrets** (–≤–∫–ª–∞–¥–∫–∞)

### 2. –î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã

–ù–∞–∂–∏–º–∞–π—Ç–µ **New secret** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ:

**–°–µ–∫—Ä–µ—Ç 1: DOCKER_REGISTRY**

- **Name:** `DOCKER_REGISTRY`
- **Value:** `harbor.stroy-track.ru`
- **Events:** ‚úÖ –≤—Å–µ –≥–∞–ª–æ—á–∫–∏ (push, tag, pull_request, deployment, cron, manual)
- **Save**

**–°–µ–∫—Ä–µ—Ç 2: DOCKER_USERNAME**

- **Name:** `DOCKER_USERNAME`
- **Value:** `admin` (–∏–ª–∏ –≤–∞—à –ª–æ–≥–∏–Ω –æ—Ç Harbor)
- **Events:** ‚úÖ –≤—Å–µ –≥–∞–ª–æ—á–∫–∏
- **Save**

**–°–µ–∫—Ä–µ—Ç 3: DOCKER_PASSWORD**

- **Name:** `DOCKER_PASSWORD`
- **Value:** –≤–∞—à –ø–∞—Ä–æ–ª—å –æ—Ç Harbor
- **Events:** ‚úÖ –≤—Å–µ –≥–∞–ª–æ—á–∫–∏
- **Save**

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞

–°–µ–∫—Ä–µ—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ (–∑–Ω–∞—á–µ–Ω–∏—è —Å–∫—Ä—ã—Ç—ã `****`).

---

## –†–∞–±–æ—Ç–∞ –≤ UI: –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.woodpecker.yml`

–í –∫–æ—Ä–Ω–µ –≤–∞—à–µ–≥–æ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.woodpecker.yml`:

```yaml
when:
  branch:
    - stage
    - prod

steps:
  build-docker:
    image: plugins/docker
    settings:
      registry:
        from_secret: DOCKER_REGISTRY
      username:
        from_secret: DOCKER_USERNAME
      password:
        from_secret: DOCKER_PASSWORD
      repo: harbor.stroy-track.ru/stroytrack/${CI_REPO_NAME}
      tags:
        - ${CI_COMMIT_BRANCH}-${CI_COMMIT_SHA:0:8}
        - ${CI_COMMIT_BRANCH}-latest
      dockerfile: Dockerfile
```

### 2. –ó–∞–ø—É—à—å—Ç–µ –≤ GitHub

```bash
git add .woodpecker.yml
git commit -m "Add Woodpecker CI pipeline"
git push origin stage  # –∏–ª–∏ prod
```

### 3. –°–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ UI

1. **Repositories** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. **Pipelines** (–≤–∫–ª–∞–¥–∫–∞) - –≤–∏–¥–∏—Ç–µ –∑–∞–ø—É—â–µ–Ω–Ω—É—é —Å–±–æ—Ä–∫—É
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ø–∞–π–ø–ª–∞–π–Ω ‚Üí –≤–∏–¥–∏—Ç–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–°—Ç–∞—Ç—É—Å—ã:**

- üü° **Pending** - –∂–¥–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
- üîµ **Running** - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- üü¢ **Success** - —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω
- üî¥ **Failure** - –æ—à–∏–±–∫–∞

---

## –†–∞–±–æ—Ç–∞ –≤ UI: –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–±–æ—Ä–∫–∏

1. **Repositories** ‚Üí —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. **Pipelines** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–π–ø–ª–∞–π–Ω (–∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–æ–∫—É)
3. –í–∏–¥–∏—Ç–µ –≤—Å–µ —à–∞–≥–∏ (steps)
4. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —à–∞–≥ ‚Üí –≤–∏–¥–∏—Ç–µ –ª–æ–≥–∏ —ç—Ç–æ–≥–æ —à–∞–≥–∞

### –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞–π–ø–ª–∞–π–Ω

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–π–ø–ª–∞–π–Ω
2. –ö–Ω–æ–ø–∫–∞ **Restart** (—Å–ø—Ä–∞–≤–∞ —Å–≤–µ—Ä—Ö—É)
3. –ü–∞–π–ø–ª–∞–π–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∑–∞–Ω–æ–≤–æ —Å —Ç–µ–º–∏ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

---

## –†–∞–±–æ—Ç–∞ –≤ UI: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞–π–ø–ª–∞–π–Ω –≤—Ä—É—á–Ω—É—é –±–µ–∑ –ø—É—à–∞ –≤ Git:

1. **Repositories** ‚Üí —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –ö–Ω–æ–ø–∫–∞ **Trigger pipeline** (—Å–ø—Ä–∞–≤–∞ —Å–≤–µ—Ä—Ö—É, –∏–∫–æ–Ω–∫–∞ play)
3. –í—ã–±–µ—Ä–∏—Ç–µ:
   - **Branch:** `stage` –∏–ª–∏ `prod`
   - **Variables:** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
4. **Trigger**

–ü–∞–π–ø–ª–∞–π–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–µ—Ç–∫–∏.

---

## –†–∞–±–æ—Ç–∞ –≤ UI: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–≥–µ–Ω—Ç–æ–≤

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–æ–ª—å–∫–æ –∞–≥–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **Admin Settings** (–∏–∫–æ–Ω–∫–∞ —à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∏, –ø—Ä–∞–≤—ã–π –≤–µ—Ä—Ö)
2. **Agents** (–≤–∫–ª–∞–¥–∫–∞)
3. –í–∏–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤:
   - **Status:** Online/Offline
   - **Platform:** linux
   - **Capacity:** —Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω—è–µ—Ç

---

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤

–£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≥–µ–Ω—Ç–æ–≤ (–±–æ–ª—å—à–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Å–±–æ—Ä–æ–∫):

### –ß–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª:

1. –ò–∑–º–µ–Ω–∏—Ç–µ –≤ —Ñ–∞–π–ª–µ `woodpecker-values.yaml`:

```yaml
agent:
  replicas: 5 # –±—ã–ª–æ 2
```

2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
helm upgrade woodpecker \
  oci://ghcr.io/woodpecker-ci/helm/woodpecker \
  --namespace woodpecker \
  --values woodpecker-values.yaml
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Lens:

1. **Workloads** ‚Üí **Pods** ‚Üí namespace: `woodpecker`
2. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 5 –ø–æ–¥–æ–≤ `woodpecker-agent-xxxxx`

---

## –£–¥–∞–ª–µ–Ω–∏–µ

### –ß–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª:

```bash
# –£–¥–∞–ª–∏—Ç—å Helm release
helm uninstall woodpecker -n woodpecker

# –£–¥–∞–ª–∏—Ç—å PVC (–¥–∞–Ω–Ω—ã–µ)
kubectl delete pvc -n woodpecker --all

# –£–¥–∞–ª–∏—Ç—å namespace
kubectl delete namespace woodpecker
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Lens:

1. **Helm** ‚Üí **Releases** ‚Üí namespace `woodpecker` –¥–æ–ª–∂–µ–Ω –∏—Å—á–µ–∑–Ω—É—Ç—å
2. **Namespaces** ‚Üí `woodpecker` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–¥–∞–ª–µ–Ω

---

## Troubleshooting —á–µ—Ä–µ–∑ Lens

### –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. **Workloads** ‚Üí **Pods** ‚Üí `woodpecker-server-xxxxx`
2. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ø–æ–¥ ‚Üí **Logs**
3. –°–º–æ—Ç—Ä–∏—Ç–µ –æ—à–∏–±–∫—É

**–ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

- –ù–µ–≤–µ—Ä–Ω—ã–π GitHub Client ID/Secret
- –ù–µ–≤–µ—Ä–Ω—ã–π host URL (–¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –¥–æ–º–µ–Ω–æ–º)

### –ê–≥–µ–Ω—Ç—ã –Ω–µ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è

1. **Workloads** ‚Üí **Pods** ‚Üí `woodpecker-agent-xxxxx`
2. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ø–æ–¥ ‚Üí **Logs**
3. –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞: `successfully connected to server`

### –ü–∞–π–ø–ª–∞–π–Ω –≤–∏—Å–∏—Ç –≤ Pending

**–ü—Ä–∏—á–∏–Ω–∞:** –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:**

- –£–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≥–µ–Ω—Ç–æ–≤ (—Å–º. "–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ")
- –ò–õ–ò –ø–æ–¥–æ–∂–¥–∏—Ç–µ –ø–æ–∫–∞ —Ç–µ–∫—É—â–∏–µ —Å–±–æ—Ä–∫–∏ –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ UI

### Badge (–±–µ–π–¥–∂ —Å—Ç–∞—Ç—É—Å–∞) –¥–ª—è README

1. **Repositories** ‚Üí —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. **Settings** ‚Üí **Badge** (–≤–∫–ª–∞–¥–∫–∞)
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Markdown –∫–æ–¥
4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ `README.md` –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ

–ë—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å—Ç–∞—Ç—É—Å —Å–±–æ—Ä–∫–∏: ‚úÖ –∏–ª–∏ ‚ùå

### Cron (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ —Å–±–æ—Ä–∫–∏)

1. **Repositories** ‚Üí —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. **Settings** ‚Üí **Cron** (–≤–∫–ª–∞–¥–∫–∞)
3. **New cron job**:
   - **Name:** `nightly-build`
   - **Branch:** `stage`
   - **Schedule:** `0 2 * * *` (–∫–∞–∂–¥—É—é –Ω–æ—á—å –≤ 2:00)
4. **Save**

### Webhooks (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã)

GitHub webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ Enable —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**

1. GitHub ‚Üí –≤–∞—à —Ä–µ–ø–æ ‚Üí **Settings** ‚Üí **Webhooks**
2. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å webhook –Ω–∞ `https://woodpecker.stroy-track.ru/api/hook`
