# ==============================================================================
# Woodpecker CI - Production Configuration
# ==============================================================================
# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://woodpecker-ci.org/docs/administration/setup
#
# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
# - Server (StatefulSet) - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, API, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è
# - Agent (Deployment) - –≤–æ—Ä–∫–µ—Ä—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è pipeline –∑–∞–¥–∞—á
# - Database - SQLite (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è) –∏–ª–∏ –≤–Ω–µ—à–Ω—è—è PostgreSQL/MySQL
#
# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
# - –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Kubernetes Secret 'woodpecker-secret'
# - –ù–ï —É–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –Ω–∞–ø—Ä—è–º—É—é –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ!
# ==============================================================================

# –°–µ–∫—Ä–µ—Ç—ã (—Å–æ–∑–¥–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –≤ namespace woodpecker –≤ secret woodpecker-secret):
#
# WOODPECKER_GITHUB: "true"
# WOODPECKER_GITHUB_CLIENT: "YOUR_GITHUB_OAUTH_CLIENT_ID"
# WOODPECKER_GITHUB_SECRET: "YOUR_GITHUB_OAUTH_CLIENT_SECRET"
# WOODPECKER_HOST: "https://example.com"
# WOODPECKER_ADMIN: "YOUR_GITHUB_USERNAME"

# Ingress:
# - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥–æ–º–µ–Ω: example.com

# ------------------------------------------------------------------------------
# SERVER - –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Woodpecker
# ------------------------------------------------------------------------------
server:
  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫ —Å–µ—Ä–≤–µ—Ä–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 1 –¥–ª—è SQLite)
  replicas: 1

  # –†–µ—Å—É—Ä—Å—ã —Å–µ—Ä–≤–µ—Ä–∞
  resources:
    requests:
      cpu: 100m # –ú–∏–Ω–∏–º—É–º CPU (0.1 —è–¥—Ä–∞)
      memory: 128Mi # –ú–∏–Ω–∏–º—É–º RAM (128 –º–µ–≥–∞–±–∞–π—Ç)
    limits:
      cpu: 500m # –ú–∞–∫—Å–∏–º—É–º CPU (0.5 —è–¥—Ä–∞)
      memory: 512Mi # –ú–∞–∫—Å–∏–º—É–º RAM (512 –º–µ–≥–∞–±–∞–π—Ç)

  # –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö (–±–∞–∑–∞ SQLite, –ª–æ–≥–∏, –∫–µ—à)
  persistence:
    enabled: true
    storageClass: "ceph-rbd" # ‚Üê –í–∞—à StorageClass –∏–∑ Ceph
    size: 5Gi # –†–∞–∑–º–µ—Ä –¥–∏—Å–∫–∞

  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
  env:
    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—É—Ä–æ–≤–Ω–∏: trace, debug, info, warn, error)
    WOODPECKER_LOG_LEVEL: "info"

    # ‚ÑπÔ∏è –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (WOODPECKER_HOST, WOODPECKER_ADMIN, WOODPECKER_GITHUB, –∏ —Ç.–¥.)
    # –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ Kubernetes Secret 'woodpecker-secret' (—Å–º. –Ω–∏–∂–µ)

  # üîê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –∏–∑ Kubernetes Secret
  # –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ Secret –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
  extraSecretNamesForEnvFrom:
    - woodpecker-secret # ‚Üê –ò–º—è Secret —Å GitHub credentials

  # Ingress - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è HTTP —Ç—Ä–∞—Ñ–∏–∫–∞
  ingress:
    enabled: true
    ingressClassName: nginx # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è NGINX Ingress Controller

    hosts:
      - host: example.com # ‚Üê –í–∞—à –¥–æ–º–µ–Ω
        paths:
          - path: /
            pathType: Prefix

    # TLS/SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ Nginx Proxy Manager)
    tls: []

    # –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è Ingress
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "false" # SSL –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ NPM
      nginx.ingress.kubernetes.io/proxy-read-timeout: "3600" # –¢–∞–π–º–∞—É—Ç —á—Ç–µ–Ω–∏—è (1 —á–∞—Å)
      nginx.ingress.kubernetes.io/proxy-send-timeout: "3600" # –¢–∞–π–º–∞—É—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ (1 —á–∞—Å)
      nginx.ingress.kubernetes.io/proxy-body-size: "100m" # –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä body (–¥–ª—è Docker –æ–±—Ä–∞–∑–æ–≤)

  # –°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Agent –∫ Server
  createAgentSecret: true

# ------------------------------------------------------------------------------
# AGENT - –í–æ—Ä–∫–µ—Ä—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è pipeline –∑–∞–¥–∞—á
# ------------------------------------------------------------------------------
agent:
  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≥–µ–Ω—Ç–æ–≤ (–º–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å)
  # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: 2-5 –¥–ª—è —Å—Ç–∞—Ä—Ç–∞, –±–æ–ª—å—à–µ –µ—Å–ª–∏ –º–Ω–æ–≥–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Å–±–æ—Ä–æ–∫
  replicas: 2

  # –†–µ—Å—É—Ä—Å—ã –∞–≥–µ–Ω—Ç–∞
  resources:
    requests:
      cpu: 200m # –ú–∏–Ω–∏–º—É–º CPU (0.2 —è–¥—Ä–∞)
      memory: 256Mi # –ú–∏–Ω–∏–º—É–º RAM (256 –º–µ–≥–∞–±–∞–π—Ç)
    limits:
      cpu: 2000m # –ú–∞–∫—Å–∏–º—É–º CPU (2 —è–¥—Ä–∞)
      memory: 2Gi # –ú–∞–∫—Å–∏–º—É–º RAM (2 –≥–∏–≥–∞–±–∞–π—Ç–∞)

  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∞–≥–µ–Ω—Ç–∞
  env:
    # Backend –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á (kubernetes = –ø–æ–¥—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ)
    WOODPECKER_BACKEND: kubernetes

    # Namespace –≥–¥–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–¥—ã –¥–ª—è pipeline –∑–∞–¥–∞—á
    WOODPECKER_BACKEND_K8S_NAMESPACE: woodpecker

    # –°–æ–∑–¥–∞–≤–∞—Ç—å –ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π namespace –¥–ª—è –∫–∞–∂–¥–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ GitHub
    WOODPECKER_BACKEND_K8S_NAMESPACE_PER_ORGANIZATION: false

    # –†–∞–∑–º–µ—Ä volume –¥–ª—è –∑–∞–¥–∞—á (–¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤)
    WOODPECKER_BACKEND_K8S_VOLUME_SIZE: 10G

    # Storage —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π ReadWriteMany (–¥–ª—è –æ–±—â–µ–≥–æ –∫–µ—à–∞ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏)
    WOODPECKER_BACKEND_K8S_STORAGE_RWX: true

    # –ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞
    WOODPECKER_SERVER: woodpecker-server:9000

    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
    WOODPECKER_CONNECT_RETRY_COUNT: "1"

  # üîê Agent Secret (–¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Server)
  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ server.createAgentSecret: true
  # Agent secret –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Helm chart
  extraSecretNamesForEnvFrom: []

  # –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∞–≥–µ–Ω—Ç–∞ (–¥–ª—è –∫–µ—à–∞, –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤)
  persistence:
    enabled: true
    size: 1Gi
    storageClass: "" # –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω default StorageClass

  # Service Account —Å –ø—Ä–∞–≤–∞–º–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–¥—ã
  serviceAccount:
    create: true # –°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    rbac:
      create: true # –°–æ–∑–¥–∞—Ç—å Role –∏ RoleBinding

# ------------------------------------------------------------------------------
# DATABASE - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
# ------------------------------------------------------------------------------
database:
  # –¢–∏–ø –ë–î:
  # - sqlite: –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è, –ø—Ä–æ—Å—Ç–∞—è, —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ –¥–∏—Å–∫–µ server.persistence
  # - postgres: –≤–Ω–µ—à–Ω—è—è PostgreSQL (–¥–ª—è production —Å –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π)
  # - mysql: –≤–Ω–µ—à–Ω—è—è MySQL
  type: sqlite

# ------------------------------------------------------------------------------
# –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
# ------------------------------------------------------------------------------

# –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–º—ë–Ω —Ä–µ—Å—É—Ä—Å–æ–≤ (–æ–±—ã—á–Ω–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
nameOverride: ""
fullnameOverride: ""

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ Kubernetes –æ–±—ä–µ–∫—Ç—ã (ConfigMap, Secret, –∏ —Ç.–¥.)
additionalObjects: []
